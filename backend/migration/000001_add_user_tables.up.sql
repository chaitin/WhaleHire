CREATE TABLE "admins" (
    "id" uuid NOT NULL DEFAULT gen_random_uuid(),
    "username" character varying NOT NULL,
    "password" character varying NOT NULL,
    "status" character varying NOT NULL,
    "last_active_at" timestamptz NOT NULL,
    "created_at" timestamptz NOT NULL,
    "updated_at" timestamptz NOT NULL,
    PRIMARY KEY ("id")
);
CREATE UNIQUE INDEX "admins_username_key" ON "admins" ("username");
CREATE TABLE "admin_login_histories" (
    "id" uuid NOT NULL DEFAULT gen_random_uuid(),
    "ip" character varying NOT NULL,
    "country" character varying NOT NULL,
    "province" character varying NOT NULL,
    "city" character varying NOT NULL,
    "isp" character varying NULL,
    "asn" character varying NULL,
    "client_version" character varying NULL,
    "device" character varying NULL,
    "created_at" timestamptz NOT NULL,
    "admin_id" uuid NULL,
    PRIMARY KEY ("id"),
    CONSTRAINT "admin_login_histories_admins_login_histories" FOREIGN KEY ("admin_id") REFERENCES "admins" ("id") ON DELETE
    SET NULL
);
CREATE TABLE "roles" (
    "id" bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    "name" character varying NOT NULL,
    "description" text NOT NULL,
    "created_at" timestamptz NOT NULL,
    PRIMARY KEY ("id")
);
-- Insert default roles
INSERT INTO "roles" ("id", "name", "description", "created_at")
VALUES (1, '超级管理员', '系统超级管理员，拥有所有权限', NOW()),
    (2, '普通管理员', '普通管理员，拥有基本管理权限', NOW());
CREATE TABLE "admin_roles" (
    "id" uuid NOT NULL DEFAULT gen_random_uuid(),
    "admin_id" uuid NOT NULL,
    "role_id" bigint NOT NULL,
    PRIMARY KEY ("id"),
    CONSTRAINT "admin_roles_admins_admin" FOREIGN KEY ("admin_id") REFERENCES "admins" ("id") ON DELETE NO ACTION,
    CONSTRAINT "admin_roles_roles_role" FOREIGN KEY ("role_id") REFERENCES "roles" ("id") ON DELETE NO ACTION
);
CREATE UNIQUE INDEX "adminrole_role_id_admin_id" ON "admin_roles" ("role_id", "admin_id");
CREATE TABLE "users" (
    "id" uuid NOT NULL DEFAULT gen_random_uuid(),
    "deleted_at" timestamptz NULL,
    "username" character varying NULL,
    "password" character varying NULL,
    "email" character varying NULL,
    "avatar_url" character varying NULL,
    "platform" character varying NOT NULL DEFAULT 'email',
    "status" character varying NOT NULL DEFAULT 'active',
    "created_at" timestamptz NOT NULL,
    "updated_at" timestamptz NOT NULL,
    PRIMARY KEY ("id")
);
CREATE TABLE "user_identities" (
    "id" uuid NOT NULL DEFAULT gen_random_uuid(),
    "deleted_at" timestamptz NULL,
    "platform" character varying NOT NULL DEFAULT 'email',
    "identity_id" character varying NOT NULL,
    "union_id" character varying NULL,
    "nickname" character varying NULL,
    "email" character varying NULL,
    "avatar_url" character varying NULL,
    "created_at" timestamptz NOT NULL,
    "user_id" uuid NULL,
    PRIMARY KEY ("id"),
    CONSTRAINT "user_identities_users_identities" FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON DELETE
    SET NULL
);
CREATE TABLE "user_login_histories" (
    "id" uuid NOT NULL DEFAULT gen_random_uuid(),
    "ip" character varying NOT NULL,
    "country" character varying NOT NULL,
    "province" character varying NOT NULL,
    "city" character varying NOT NULL,
    "isp" character varying NULL,
    "asn" character varying NULL,
    "client_version" character varying NULL,
    "os_type" character varying NULL,
    "os_release" character varying NULL,
    "hostname" character varying NULL,
    "client_id" character varying NULL,
    "created_at" timestamptz NOT NULL,
    "user_id" uuid NULL,
    PRIMARY KEY ("id"),
    CONSTRAINT "user_login_histories_users_login_histories" FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON DELETE
    SET NULL
);